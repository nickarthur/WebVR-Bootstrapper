"use strict";function AbstractVRDisplayPolyfill(e,t,n,r,i,o){var s=this;this.capabilities={canPresent:e,hasExternalDisplay:!1,hasOrientation:t,hasPosition:n},this.displayID=r,this.displayName=i,this.isConnected=!0,this.isPresenting=!1,this.stageParameters=null;var a=null,l=function u(){FullScreen.removeChangeListener(u),s.exitPresent(),window.dispatchEvent(new Event("vrdisplaypresentchange"))};this.requestPresent=function(e){return s.capabilities.canPresent?e?e instanceof Array?1!==e.length?Promise.reject(new Error("Only one layer at a time is supported right now.")):e[0].source?o(e).then(function(t){return a=e[0],s.isPresenting=t===a.source,FullScreen.addChangeListener(l,!1),window.dispatchEvent(new Event("vrdisplaypresentchange")),t}):Promise.reject(new Error("No source on layer parameter.")):Promise.reject(new Error("Layers parameters must be an array")):Promise.reject(new Error("No layers provided to requestPresent")):Promrise.reject(new Error("This device cannot be used as a presentation display. DisplayID: "+s.displayId+". Name: "+s.displayName))},this.getLayers=function(){return a?[a]:[]},this.exitPresent=function(){var e=function(e){return s.isPresenting=!1,a=null,e};return FullScreen.exit().then(e)["catch"](function(t){console.error(t.message||t),e()})},this.requestAnimationFrame=function(e){window.requestAnimationFrame(e)},this.cancelAnimationFrame=function(e){window.cancelAnimationFrame(e)},this.submitFrame=function(){}}function CardboardVRDisplayPolyfill(){AbstractVRDisplayPolyfill.call(this,!0,isMobile,!1,"B4CEAE28-1A89-4314-872E-9C223DDABD02","Device Motion API",function(e){return FullScreen.request(e[0].source)});var e,t=null,n=(Math.sqrt(.5),0);this.getEyeParameters=function(e){if("left"===e||"right"===e){var t="left"===e?-1:1;return{renderWidth:Math.floor(screen.width*devicePixelRatio/2),renderHeight:screen.height*devicePixelRatio,offset:new Float32Array([.03*t,0,0]),fieldOfView:{upDegrees:40,downDegrees:40,leftDegrees:40,rightDegrees:40}}}},this.getImmediatePose=function(){return t},this.getPose=function(){return t},this.resetPose=function(){n=e}}function LegacyVRDisplayPolyfill(e,t){function n(e,t){for(var n="",r=e.deviceName,i=t.deviceName,o=0;o<r.length&&o<i.length&&r[o]===i[o];++o)n+=r[o];for(;n.length>0&&!/\w/.test(n[n.length-1]);)n=n.substring(0,n.length-1);return n}function r(e){var t={timestamp:e.timestamp,frameID:++i,position:null,linearVelocity:null,linearAcceleration:null,orientation:null,angularVelocity:null,angularAcceleration:null};return o.forEach(function(n){if(e[n]){var r=[e[n].x,e[n].y,e[n].z];"orientation"===n&&r.push(e[n].w),t[n]=new Float32Array(r)}}),t}var i=0,o=["position","linearVelocity","linearAcceleration","orientation","angularVelocity","angularAcceleration"];AbstractVRDisplayPolyfill.call(this,!!e,!!t,!!t,e.hardwareUnitId,n(e,t),function(t){return FullScreen.request(t[0].source,{vrDisplay:e,vrDistortion:!0})}),this.getEyeParameters=function(t){var n=null;n=e.getEyeParameters?e.getEyeParameters(t):{renderRect:e.getRecommendedEyeRenderRect(t),eyeTranslation:e.getEyeTranslation(t),recommendedFieldOfView:e.getRecommendedEyeFieldOfView(t)};var r={renderWidth:n.renderRect.width,renderHeight:n.renderRect.height,offset:new Float32Array([n.eyeTranslation.x,n.eyeTranslation.y,n.eyeTranslation.z]),fieldOfView:n.recommendedFieldOfView};return r},this.getImmediatePose=function(){return r(t.getImmediateState())},this.getPose=function(){return r(t.getState())},this.resetPose=t.resetSensor.bind(t)}function StandardMonitorPolyfill(){AbstractVRDisplayPolyfill.call(this,!0,!1,!1,"39025D3C-3B12-4F92-9FF5-85DC887CB545","Standard Monitor",function(e){return FullScreen.request(e[0].source)}),Object.defineProperty(this,"isPresenting",{get:function(){return!0},set:function(){}});var e={timestamp:0,frameID:0,orientation:new Float32Array([0,0,0,1])};this.getEyeParameters=function(e){return"left"===e?{renderWidth:screen.width*devicePixelRatio,renderHeight:screen.height*devicePixelRatio,offset:new Float32Array([0,0,0]),fieldOfView:{upDegrees:75,downDegrees:75,leftDegrees:75,rightDegrees:75}}:void 0},this.getImmediatePose=function(){return e},this.getPose=function(){return e},this.resetPose=function(){}}function WebVRBootstrapper(e,t){function n(){if("complete"===document.readyState){var r=WebVRBootstrapper.Version;if(1===r){if(isMobile){var i=VRDisplay.prototype.requestPresent;VRDisplay.prototype.requestPresent=function(e){return i.call(this,e[0])}}}else.5===r?navigator.getVRDisplays=function(){return navigator.getVRDevices().then(function(e){for(var t={},n=null,r=0;r<e.length;++r){var i=e[r];n=i.hardwareUnitId,t[n]||(t[n]={});var o=t[n];i instanceof HMDVRDevice?o.display=i:e[r]instanceof PositionSensorVRDevice&&(o.sensor=i)}var s=[];for(n in t)s.push(new LegacyVRDisplayPolyfill(t[n].display,t[n].sensor));return s})}:.4===r?navigator.getVRDisplays=Promise.reject.bind(Promise,"You're using an extremely old version of Firefox Nightly. Please update your browser. https://webvr.info/get-chrome/"):.1===r?navigator.getVRDisplays=Promise.resolve.bind(Promise,[new CardboardVRDisplayPolyfill]):navigator.getVRDisplays=Promise.resolve.bind(Promise,[]);var o=navigator.getVRDisplays;return navigator.getVRDisplays=function(){return o.call(navigator).then(function(e){return e.unshift(new StandardMonitorPolyfill),e})},document.removeEventListener("readystatechange",n),t(loadFiles.bind(null,e)),!0}}n()||document.addEventListener("readystatechange",n)}window.isMobile=/(android|iP(hone|od|ad))/.test(navigator.userAgent);var FullScreen=function(){function e(e,t,n,r){for(var i=0;i<t.length;++i){var o=n+t[i]+r;if(void 0!==e[o])return o}}var t=e(document,["fulls","mozFullS","webkitFulls","msFulls"],"","creenElement"),n=e(document,["","moz","webkit","ms"],"on","fullscreenchange"),r=e(document,["","moz","webkit","ms"],"on","fullscreenerror"),i=e(document.documentElement,["requestFulls","mozRequestFullS","webkitRequestFulls","webkitRequestFullS","msRequestFulls"],"","creen"),o=e(document,["exitFulls","mozExitFullS","webkitExitFulls","webkitExitFullS","msExitFulls"],"","creen");n=n&&n.substring(2),r=r&&r.substring(2);var s={addChangeListener:function(e,t){return document.addEventListener(n,e,t)},removeChangeListener:function(e){return document.removeEventListener(n,e)},addErrorListener:function(e,t){return document.addEventListener(r,e,t)},removeErrorListener:function(e){return document.removeEventListener(r,e)},withChange:function(e){return new Promise(function(t,n){var r,i,o,s=function(){o&&clearTimeout(o),FullScreen.removeChangeListener(r),FullScreen.removeErrorListener(i)};r=function(){setTimeout(s),t(FullScreen.element)},i=function(e){setTimeout(s),n(e)},FullScreen.addChangeListener(r,!1),FullScreen.addErrorListener(i,!1),e()?(s(),t(FullScreen.element)):o=setTimeout(function(){s(),n("Fullscreen state did not change in allotted time")},1e3)})},request:function(e,t){return FullScreen.withChange(function(){if(!i)throw new Error("No Fullscreen API support.");return FullScreen.isActive?!0:void(t?e[i](t):isChrome?e[i](window.Element.ALLOW_KEYBOARD_INPUT):e[i]())})},exit:function(){return FullScreen.withChange(function(){if(!o)throw new Error("No Fullscreen API support.");return FullScreen.isActive?void document[o]():!0})}};return Object.defineProperties(s,{element:{get:function(){return document[t]}},isActive:{get:function(){return!!FullScreen.element}}}),s}(),loadFiles=function(){function e(e,t,n){var r=new XMLHttpRequest;r.onload=function(){r.status<400&&t(r.response)},r.open("GET",e),r.onprogress=n,r.send()}function t(n,r,i,o,s,a,l){if(o<n.length){var u=n[o][0],c=(n[o][1],u.match(/\.\w+$/)[0]||"none"),d=l;e(u,function(e){if(".js"===c){var u=document.createElement("script");u.type="text/javascript",u.appendChild(document.createTextNode(e)),document.head.appendChild(u)}t(n,r,i,o+1,s,a,l)},function(e){return i(l=d+e.loaded,a)})}else r(s)}return function(n,r,i){function o(e){for(var n=0,o=0;o<e.length;++o)n+=e[o][1];i=i||console.log.bind(console,"File load progress"),t(e,r,i,0,{},n,0)}n instanceof String||"string"==typeof n?e(n,function(e){o(JSON.parse(e))}):n instanceof Array&&o(n)}}();WebVRBootstrapper.Version=function(){return navigator.getVRDisplays?1:navigator.getVRDevices?.5:navigator.mozGetVRDevices?.4:isMobile?.1:0}();