"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function _inherits(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function _inherits(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();window.isMobile=function(e){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substring(0,4))}(navigator.userAgent||navigator.vendor||window.opera);var AbstractVRDisplayPolyfill=function(){function e(n,t,r,i,o){var a=this;_classCallCheck(this,e),this.capabilities={canPresent:n,hasExternalDisplay:!1,hasOrientation:t,hasPosition:r},this.displayID=i,this.displayName=o,this.isConnected=!0,this.isPresenting=!1,this.stageParameters=null,this._currentLayer=null,this._onFullScreenRemoved=function(){FullScreen.removeChangeListener(a._onFullScreenRemoved),a.exitPresent(),window.dispatchEvent(new Event("vrdisplaypresentchange"))}}return _createClass(e,[{key:"getLayers",value:function(){return this._currentLayer?[this._currentLayer]:[]}},{key:"exitPresent",value:function(){var e=this,n=function(n){return e.isPresenting=!1,e._currentLayer=null,n};return FullScreen.exit().then(n)["catch"](function(e){console.error(e.message||e),n()})}},{key:"requestPresent",value:function(e){var n=this;return this.capabilities.canPresent?e?e instanceof Array?1!==e.length?Promise.reject(new Error("Only one layer at a time is supported right now.")):e[0].source?this._requestPresent(e).then(function(t){return n._currentLayer=e[0],n.isPresenting=t===n._currentLayer.source,FullScreen.addChangeListener(n._onFullScreenRemoved,!1),window.dispatchEvent(new Event("vrdisplaypresentchange")),t}):Promise.reject(new Error("No source on layer parameter.")):Promise.reject(new Error("Layers parameters must be an array")):Promise.reject(new Error("No layers provided to requestPresent")):Promrise.reject(new Error("This device cannot be used as a presentation display. DisplayID: "+this.displayId+". Name: "+this.displayName))}},{key:"requestAnimationFrame",value:function(e){window.requestAnimationFrame(e)}},{key:"cancelAnimationFrame",value:function(e){window.cancelAnimationFrame(e)}},{key:"submitFrame",value:function(){}}]),e}(),CardboardVRDisplayPolyfill=function(e){function n(){_classCallCheck(this,n);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,!0,isMobile,!1,"B4CEAE28-1A89-4314-872E-9C223DDABD02","Device Motion API")),t=new Primrose.Input.VR.MotionCorrector,r=null,i=0;return e.getEyeParameters=function(e){var n="left"===e?-1:1;return{renderWidth:Math.floor(screen.width*devicePixelRatio/2),renderHeight:screen.height*devicePixelRatio,offset:new Float32Array([.03*n,0,0]),fieldOfView:{upDegrees:40,downDegrees:40,leftDegrees:40,rightDegrees:40}}},t.addEventListener("deviceorientation",function(e){r={timestamp:performance.now(),frameID:++i,orientation:new Float32Array(e)}}),e.getImmediatePose=function(){return r},e.getPose=function(){return r},e.resetPose=t.zeroAxes.bind(t),e._requestPresent=function(e){return FullScreen.request(e[0].source)},e}return _inherits(n,e),n}(AbstractVRDisplayPolyfill),FullScreen=function(){var e=findProperty(document,["fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement"]),n=findProperty(document,["onfullscreenchange","onmozfullscreenchange","onwebkitfullscreenchange","onmsfullscreenchange"]),t=findProperty(document,["onfullscreenerror","onmozfullscreenerror","onwebkitfullscreenerror","onmsfullscreenerror"]),r=findProperty(document.documentElement,["requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen"]),i=findProperty(document,["exitFullscreen","mozExitFullScreen","webkitExitFullscreen","webkitExitFullScreen","msExitFullscreen"]);n=n&&n.substring(2),t=t&&t.substring(2);var o={addChangeListener:function(e,t){return document.addEventListener(n,e,t)},removeChangeListener:function(e){return document.removeEventListener(n,e)},addErrorListener:function(e,n){return document.addEventListener(t,e,n)},removeErrorListener:function(e){return document.removeEventListener(t,e)},withChange:function(e){return new Promise(function(n,t){var r,i,o,a=function(){o&&clearTimeout(o),FullScreen.removeChangeListener(r),FullScreen.removeErrorListener(i)};r=function(){setTimeout(a),n(FullScreen.element)},i=function(e){setTimeout(a),t(e)},FullScreen.addChangeListener(r,!1),FullScreen.addErrorListener(i,!1),e()?(a(),n(FullScreen.element)):o=setTimeout(function(){a(),t("Fullscreen state did not change in allotted time")},1e3)})},request:function(e,n){return FullScreen.withChange(function(){if(!r)throw console.error("No Fullscreen API support."),new Error("No Fullscreen API support.");return FullScreen.isActive?!0:void(n?e[r](n):isChrome?e[r](window.Element.ALLOW_KEYBOARD_INPUT):e[r]())})},exit:function(){return FullScreen.withChange(function(){if(!i)throw console.error("No Fullscreen API support."),new Error("No Fullscreen API support.");return FullScreen.isActive?void document[i]():!0})}};return Object.defineProperties(o,{element:{get:function(){return document[e]}},isActive:{get:function(){return!!FullScreen.element}}}),o}(),LegacyVRDisplayPolyfill=function(e){function n(e,t){function r(e,n){for(var t="",r=e.deviceName,i=n.deviceName,o=0;o<r.length&&o<i.length&&r[o]===i[o];++o)t+=r[o];for(;t.length>0&&!/\w/.test(t[t.length-1]);)t=t.substring(0,t.length-1);return t}function i(e){var n={timestamp:e.timestamp,frameID:++o,position:null,linearVelocity:null,linearAcceleration:null,orientation:null,angularVelocity:null,angularAcceleration:null};return e.position&&(n.position=new Float32Array([e.position.x,e.position.y,e.position.z])),e.linearVelocity&&(n.linearVelocity=new Float32Array([e.linearVelocity.x,e.linearVelocity.y,e.linearVelocity.z])),e.linearAcceleration&&(n.linearAcceleration=new Float32Array([e.linearAcceleration.x,e.linearAcceleration.y,e.linearAcceleration.z])),e.orientation&&(n.orientation=new Float32Array([e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w])),e.angularVelocity&&(n.angularVelocity=new Float32Array([e.angularVelocity.x,e.angularVelocity.y,e.angularVelocity.z])),e.angularAcceleration&&(n.angularAcceleration=new Float32Array([e.angularAcceleration.x,e.angularAcceleration.y,e.angularAcceleration.z])),n}_classCallCheck(this,n);var o=0,a=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,!!e,!!t,!!t,e.hardwareUnitId,r(e,t)));return a.getEyeParameters=function(n){var t=null;t=e.getEyeParameters?e.getEyeParameters(n):{renderRect:e.getRecommendedEyeRenderRect(n),eyeTranslation:e.getEyeTranslation(n),recommendedFieldOfView:e.getRecommendedEyeFieldOfView(n)};var r={renderWidth:t.renderRect.width,renderHeight:t.renderRect.height,offset:new Float32Array([t.eyeTranslation.x,t.eyeTranslation.y,t.eyeTranslation.z]),fieldOfView:t.recommendedFieldOfView};return r},a.getImmediatePose=function(){return i(t.getImmediateState())},a.getPose=function(){return i(t.getState())},a.resetPose=t.resetSensor.bind(t),a._requestPresent=function(n){return FullScreen.request(n[0].source,{vrDisplay:e,vrDistortion:!0})},a}return _inherits(n,e),n}(AbstractVRDisplayPolyfill),MotionCorrector=function e(){function n(e){e.alpha&&(window.removeEventListener("deviceorientation",n),t(e),window.addEventListener("deviceorientation",t,!1))}function t(e){r=e.beta*Math.PI/180,i=e.alpha*Math.PI/180,o=-e.gamma*Math.PI/180,b=Math.PI*-window.orientation/360,a=Math.cos(r/2),s=Math.cos(i/2),l=Math.cos(o/2),E=Math.cos(b),c=Math.sin(r/2),u=Math.sin(i/2),f=Math.sin(o/2),P=Math.sin(b),m=c*s*l+a*u*f,p=a*u*l-c*s*f,d=a*s*f-c*u*l,h=a*s*l+c*u*f,k[0]=m+C*d,k[1]=C*h+p,k[2]=d-C*m,k[3]=h-C*p,y=k[0]*E-k[2]*P,g=k[1]*E+k[3]*P,w=k[2]*E+k[0]*P,v=k[3]*E-k[1]*P,k[0]=y*F-v*F,k[1]=g*F-w*F,k[2]=w*F+g*F,k[3]=v*F+y*F;for(var n=0;n<_.length;++n)_[n](k)}_classCallCheck(this,e);var r,i,o,a,s,l,c,u,f,m,p,d,h,y,g,w,v,b,P,E,k=[0,0,0,0],F=Math.sqrt(.5),C=0,A=!0,_=[];this.addEventListener=function(e,t,r){if("deviceorientation"!==e)throw new Error('The only event type that is supported is "deviceorientation". Type parameter was: '+e);if("function"!=typeof t)throw new Error("A function must be provided as a callback parameter. Callback parameter was: "+t);A&&(window.addEventListener("deviceorientation",n,!1),A=!1),_.push(t)},this.zeroAxes=function(){C=i}},_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),WebVRBootstrapper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"install",value:function(){if(1===e.Version&&isMobile){var n=VRDisplay.prototype.requestPresent;VRDisplay.prototype.requestPresent=function(e){return n.call(this,e[0])}}else.5===e.Version?navigator.getVRDisplays=function(){return navigator.getVRDevices().then(function(e){for(var n={},t=null,r=0;r<e.length;++r){var i=e[r];t=i.hardwareUnitId,n[t]||(n[t]={});var o=n[t];i instanceof HMDVRDevice?o.display=i:e[r]instanceof PositionSensorVRDevice&&(o.sensor=i)}var a=[];for(t in n)a.push(new LegacyVRDisplayPolyfill(n[t].display,n[t].sensor));return a})}:.4===e.Version?navigator.getVRDisplays=Promise.reject.bind(Promise,"You're using an extremely old version of Firefox Nightly. Please update your browser."):.1===e.Version?navigator.getVRDisplays=Promise.resolve.bind(Promise,[new CardboardVRDisplayPolyfill]):navigator.getVRDisplays=Promise.reject.bind(Promise,"Your browser does not support WebVR.")}},{key:"Version",get:function(){return navigator.getVRDisplays?1:navigator.getVRDevices?.5:navigator.mozGetVRDevices?.4:isMobile?.1:0}}]),e}();